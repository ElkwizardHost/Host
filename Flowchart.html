<script>
	const flowchartData = {"nodes":{"ReligiousCulturalWars":{"name":"ReligiousCulturalWars","text":"Religious and Cultural Wars|As more and more people traveled around the globe and 'discovered' new places, they often found things they didn't like. Various people, such as Columbus and Zheng He, travelled far away from their homelands. When doing this, they found people with different beliefs and cultures. War seemed to be a catch all solution in the past, and so many killings, battles, and wars sprang up across the globe as a result of people realizing that other people are different.","children":["Racism"],"level":1},"GlobalAwareness":{"name":"GlobalAwareness","text":"Global Awareness|As many countries and civilizations sent explorers out into the world, they learned about many other previously unknown countries that were just as complex. As this process continued around the globe, more and more people became aware that an entire world existed outside of their city walls. This led to the interconnected and aware world we have today, where we have the ability to learn about the history and culture of places across the world from us.","children":["ReligiousCulturalWars"],"level":2},"GlobalTravel":{"name":"GlobalTravel","text":"Global Travel|Due to the increase in explorers and merchants going all around the world, people were finding better and better ways to get necessary people from point A to point B. However, eventually these travel methods were robust enough that even normal people could travel all around the world, as long as they had enough money. This was an unprecedented level of connectivity.","children":["GlobalEconomy","ReligiousCulturalWars","EuropeanColonization"],"level":3},"GlobalEconomy":{"name":"GlobalEconomy","text":"Global Economy|With people travelling across the globe, colonizing continents, and trading amongst a larger group that ever before, the concept of a global economy became truly apparent. The global economy is a single term to describe various trade networks, including, but not limited to","children":["PortuguesePorts","EconomicScope","GlobalAwareness","BetterFood"],"level":2},"EconomicScope":{"name":"EconomicScope","text":"Economic Scope|As merchants brought in purchased goods from around the world, local businesses and governments couldn't avoid thinking about the new scope of the economy. Any country that denied the existence of a global economy would be doomed to create useless or closedminded laws that didn't account for the outside competition.","children":[],"level":0},"Columbus":{"name":"Columbus","text":"Columbus|Having recieved permission and funding from Spain to go to 'India', Christopher Columbus connected the previously un-globalized Americas to the rest of the powerful network of Europe, Africa, and India. However, with the millions of deaths he and his crew caused, it probably wasn't worth the horses they eventually got. Most of the Americas were doing better before Europe arrived, but the people in the Americas who survived the Europeans were able to take part in all of the wonderful things that the other side of the world had to offer.","children":["EuropeanColonization","GlobalAwareness","GlobalTravel","ReligiousCulturalWars"],"level":3},"ZhengHe":{"name":"ZhengHe","text":"Zheng He|Zheng He travelled with hundreds of ships out from China and tried to convince the 'barbarians' he found to practice Chinese culture. When the natives did not want to practice Chinese culture however, he and his crew would attack or kill them. Both the awareness of China he spread around the sea and the incredible ship building technology used to make boats the explorers sailed.","children":["GlobalAwareness","GlobalTravel"],"level":4},"PortuguesePorts":{"name":"PortuguesePorts","text":"Portuguese Ports|With the increased trade around the world that a global economy allowed, controlling trade became a much more profitable profession. Because of this, Portugal conquered the ports leading into and out of Africa. They then 'taxed' goods going through their ports, and though it didn't last long, it made Portugal very rich (for a while).","children":[],"level":0},"SpiceTrade":{"name":"SpiceTrade","text":"Spice Trade|With the incredible blandness of medieval European food and the enormous wealth of European rulers, spices were in high demand. As more and more merchants left Europe and got rich trading, they realized that spices from India and Africa would be worth the same or more than gold. As people around the world realized this, spices became one of the most sought after goods. The optimization of getting spices from place to place was a large factor in the construction of a global travel network and economy.","children":["IndianOceanTrade","BetterFood"],"level":3},"SilkTrade":{"name":"SilkTrade","text":"Silk Trade|A significant amount of Europe wanted silk, and so there was motivation to create a cheap trade route between Europe and China. The process of creating such a trade route increases the interconnectivity of Europe, Africa, and Asia. This trade route was also used for porcelain and silver, though the silver was going in the opposite direction.","children":["IndianOceanTrade"],"level":3},"AtlanticSlavery":{"name":"AtlanticSlavery","text":"Trans-Atlantic Slave Trade|Once Europe had a robust trade network with the rest of the world, they quickly ran out of things to trade. They needed more labor to fund their thirst for trade. Since Europe had 'discovered' Africa, and they needed labor, they decided that the natives they found there were barbaric and inferior. Due to this they brought them home and across the Atlantic Ocean to serve as brutally treated unpaid laborers. Many industries such as sugar and tobacco took off due to this nightmare.","children":["GlobalEconomy","Racism"],"level":2},"IndianOceanTrade":{"name":"IndianOceanTrade","text":"Indian Ocean Trade|During the period of convergence, Europe, Africa, and Asia were trading gold, silver, porcelain, tea, silk, and spices. Because of the high demand for all of these goods, highly efficient and profitable trade routes were discovered and built between various coasts of the Indian Ocean. Many merchants from all participating countries made money by offering simple shipping services for a higher price.","children":["PortuguesePorts","GlobalEconomy"],"level":2},"Racism":{"name":"Racism","text":"Racism|After the trans-Atlantic slave trade had ended, and quite obviously while it was happening, the idea that Africans and Native Americans were inferior to Europeans became enforced into many Europeans minds. Christopher Columbus also influenced this belief, after trying to justify the massacre he caused in North America.","children":[],"level":0},"BetterFood":{"name":"BetterFood","text":"Better Food|During the global convergence, food got better. This was because of two main reasons, the first being that since foods from all around the world could now be bought, sold, and transported around the world, people could create more flavorful food. Also due to the increased trade, there was more food for everyone around the globe (at least those who weren't part of the trans-Atlantic slave trade). The second (though similar to the first) factor is that the spice trade allowed at least those with wealth to season their food.","children":["IncreasedPopulation"],"level":1},"IncreasedPopulation":{"name":"IncreasedPopulation","text":"Increased Population|With an increase of both quality and quantity of food around the world, many more children survived to adulthood. This increase in population has continued to compound upon itself into the present day.","children":[],"level":0},"EuropeanColonization":{"name":"EuropeanColonization","text":"European Colonization|After enough European explorers had gone out into the world and discovered that there were in fact other civilizations, Europe became obsessed with taking them over. During the period of the global convergence, various European countries were sending out fleets of ships to conquer far off lands. Britain and Spain both caused North America to be colonized, Spain colonized South America, and all of Europe fought over Africa and the Middle East. Many cultures and civilizations were destroyed by this, and the impacts affect us to this day. //","children":["AtlanticSlavery"],"level":3},"FeudalismDecline":{"name":"FeudalismDecline","text":"Decline of Feudalism|As the global convergence began, the Plague had just left Europe. This plague however had created such a scarcity of serfs that they became somewhat paid workers. This quickly collapsed the system of Feudalism and allowed more people to become merchants.","children":["SpiceTrade","SilkTrade","EuropeanColonization"],"level":4}},"groups":{"Cause of Convergence":["SpiceTrade","SilkTrade","Columbus","ZhengHe","FeudalismDecline"],"Global Connectivity Change due to Convergence":["GlobalAwareness","GlobalTravel","GlobalEconomy","EconomicScope"],"Consequence of Convergence":["ReligiousCulturalWars","Racism","IncreasedPopulation","EuropeanColonization"]}}
</script>
<script src="https://elkwizard.github.io/Hengine/Hengine.js">
	window.title = "Flowchart of the Great Global Convergence";

	const contentFont = new Font(15, "Arial");
	const nameFont = new Font(20, "Arial");
	const titleFont = new Font(22, "Arial", true);
	const noteFont = titleFont.get();
	noteFont.lineHeight *= 1.2;

	let hoveredNode = null;

	function getName({ text }) {
		return text.slice(0, text.indexOf("|"));
	}

	const NODE = new ElementScript("NODE", {
		init(l, nodeData) {
			this.scripts.removeDefault();
			l.nodeData = nodeData;
			for (let groupName in groupData) {
				if (groupData[groupName].includes(l.nodeData.name)) {
					l.group = groupName;
					break;
				}
			}
			l.connectionColors = l.nodeData.children.map(child => {
				const color = Color.saturate(Random.color(), 10);
				color.brightness *= 0.8;
				// color.alpha = 0.5;
				return color;
			});

			const bb = this.getBoundingBox();
			this.graphicalBoundingBox = new Rect(bb.x, bb.y - 100, bb.width, bb.height + 100);
		},
		click(l, key) {
			// switch (key) {
			// 	case "Left":
			// 		this.hide();
			// 		break;
			// }
		},
		update(l) {

		},
		text(l, color, font, text, y, outline = false, maxWidth = this.width - 20) {
			if (outline) renderer.stroke(Color.WHITE, 3).text(font, text, 0, y, maxWidth);
			renderer.draw(color).text(font, text, 0, y, maxWidth);
		},
		afterUpdate(l) {
			if (this.hovered) {
				hoveredNode = this;
			}
		},
		draw(l, _, shape) {
			renderer.draw(Color.alpha(new Color(250, 250, 250), 0.9)).rect(shape);
			renderer.stroke(Color.BLACK).rect(shape);
			if (l.group) {
				renderer.textMode = TextMode.BOTTOM_CENTER;
				l.text(groupColors[l.group], titleFont, l.group, -this.height / 2 - 10, true);
			}
			renderer.textMode = TextMode.TOP_CENTER;
			const text = l.nodeData.text;
			const barInx = text.indexOf("|");
			const name = (barInx > -1) ? text.slice(0, barInx) : "";
			const content = (barInx > -1) ? text.slice(barInx + 1) : text;
			l.text(Color.BLACK, nameFont, name, -this.height / 2 + nameFont.size / 2, false);
			l.text(Color.BLACK, contentFont, content, -this.height / 2 + nameFont.size * 2, false);

			if (this.hovered && l.nodeData.children.length) {
				
				renderer.textMode = TextMode.TOP_CENTER;

				const string = `This connects to: \n${l.nodeData.children.map(name => "â€¢ " + getName(nodeData[name])).join("\n")}`;

				l.text(Color.BLACK, noteFont, string, this.height / 2 + 10, true, Infinity);
			}
		},
	});

	const { nodes: nodeData, groups: groupData } = flowchartData;

	const groupColors = {};
	const groupCount = Object.keys(groupData).length;
	const startColorAngle = Random.range(0, 360);
	let groupIndex = 0;
	for (let group in groupData) {
		groupIndex++;
		const color = new Color(`hsb(${startColorAngle + groupIndex * 360 / groupCount}, 100%, 100%)`);
		color.brightness /= 2;
		groupColors[group] = color;
	}

	const nodeXMap = new Map();
	const nodes = new Map();

	const nodeXMax = new Map();

	const NODE_WIDTH = 300;
	const NODE_HEIGHT = 280;

	for (let name in nodeData) {
		const data = nodeData[name];

		const level = Math.floor(data.level);

		if (!nodeXMax.has(level)) nodeXMax.set(level, 0);
		else nodeXMax.set(level, nodeXMax.get(level) + 1);
	}

	const maxY = Math.max(...Object.values(nodeData).map(data => Math.floor(data.level)));

	for (let name in nodeData) {
		const data = nodeData[name];

		const level = Math.floor(data.level);

		if (!nodeXMap.has(level)) nodeXMap.set(level, 0);
		else nodeXMap.set(level, nodeXMap.get(level) + 1);

		const x = (nodeXMap.get(level) - nodeXMax.get(level) / 2) * NODE_WIDTH * 2;
		const y = (maxY - data.level) * NODE_HEIGHT * 2;
		const node = scene.main.addRectElement("node", x, y, NODE_WIDTH, NODE_HEIGHT);
		node.scripts.add(NODE, data);

		nodes.set(data.name, node);
	}

	scene.camera.position.x = 0;

	scene.camera.zoomOut(2);

	intervals.continuous(function (time) {
		scene.camera.drawInWorldSpace(function () {
			for (let [name, node] of nodes) {
				if (node.hidden || (hoveredNode && node !== hoveredNode)) continue;

				const l = node.scripts.NODE;

				const a = node.transform.position.plus(new Vector2(0, node.height / 2))

				const { children } = l.nodeData;

				for (let i = 0; i < children.length; i++) {
					const con = children[i];
					const nodeB = nodes.get(con);

					if (nodeB.hidden) continue;

					const b = nodeB.transform.position.minus(new Vector2(0, nodeB.height / 2));

					const A = a;
					const D = b;
					const B = new Vector2(A.x, A.y + 200);
					const C = new Vector2(D.x, D.y - 200);

					// renderer.stroke(l.connectionColors[i], 4).arrow(A, D);

					renderer.stroke(l.connectionColors[i], 4).splineArrow(new Spline(A, B, C, D));
				}
			}
		});

		hoveredNode = null;
	}, IntervalFunction.UPDATE);

	let interacted = false;

	intervals.continuous(function (time) {
		if (mouse.pressed("Left")) {
			const dif = mouse.world.minus(mouse.worldLast);
			scene.camera.position.sub(dif);

			interacted = true;
		}
		if (mouse.pressed("WheelUp")) {
			interacted = true;
			scene.camera.zoomIn(0.2);
		}
		if (mouse.pressed("WheelDown")) {
			interacted = true;
			scene.camera.zoomOut(0.2);
		}

		renderer.textMode = TextMode.TOP_LEFT;
		renderer.draw(Color.BLACK).text(interacted ? Font.Arial15 : Font.Arial30, "Directions:\nLeft click and drag to move around the diagram.\nUse the mouse wheel to zoom in and out on the diagram.\nHover on a section to see what it connects to.", 10, 10);
	}, IntervalFunction.AFTER_UPDATE);
</script>
